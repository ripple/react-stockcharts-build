{"version":3,"sources":["../../../src/lib/EventCapture.js"],"names":["React","Component","PropTypes","select","event","d3Event","mouse","touches","isDefined","mousePosition","touchPosition","getTouchProps","d3Window","MOUSEMOVE","MOUSEUP","MOUSEENTER","MOUSELEAVE","TOUCHMOVE","TOUCHEND","noop","getCurrentCharts","EventCapture","props","handleEnter","bind","handleLeave","handleWheel","handleMouseMove","handleMouseDown","handlePanEnd","handlePan","handleTouchStart","handlePinchZoom","handlePinchZoomEnd","handleClick","handleRightClick","handleDrag","handleDragEnd","shouldPan","canPan","setCursorClass","saveNode","mouseInside","mouseInteraction","state","panInProgress","node","focus","on","componentDidMount","win","e","onMouseEnter","dragInProgress","onMouseLeave","zoom","onZoom","yZoom","Math","abs","deltaY","deltaX","mouseXY","preventDefault","zoomDir","panStart","panStartXScale","chartsToPan","lastNewPos","panHappened","dx","dy","dxdy","onPan","xScale","chartConfig","currentCharts","setState","panOrigin","queuePanEnd","panEndTimeout","clearTimeout","setTimeout","onMouseMove","mouseMove","newPos","onClick","onDoubleClick","dragHappened","clicked","stopPropagation","onContextMenu","onPanEnd","getBoundingClientRect","onDrag","startPos","dragStartPosition","onDragComplete","getAllPanConditions","initialPanEnabled","pan","reduce","returnObj","a","draggable","panEnabled","somethingSelected","button","onMouseDown","onDragStart","length","touchXY","touch1Pos","touch2Pos","pinchZoomStart","range","zoomEnabled","onPinchZoom","initialPinch","onPinchZoomEnd","cursorOverrideClass","height","width","className","opacity","propTypes","bool","isRequired","panSpeedMultiplier","number","array","func","xAccessor","children","defaultProps"],"mappings":"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","file":"EventCapture.js","sourcesContent":["\"use strict\";\n\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { select, event as d3Event, mouse, touches } from \"d3-selection\";\n\nimport {\n\tisDefined, mousePosition, touchPosition, getTouchProps,\n\td3Window,\n\tMOUSEMOVE, MOUSEUP,\n\tMOUSEENTER, MOUSELEAVE,\n\tTOUCHMOVE, TOUCHEND,\n\tnoop\n} from \"./utils\";\nimport { getCurrentCharts } from \"./utils/ChartDataUtil\";\n// import { clearTimeout, setTimeout } from \"timers\";\n\nclass EventCapture extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.handleEnter = this.handleEnter.bind(this);\n\t\tthis.handleLeave = this.handleLeave.bind(this);\n\t\tthis.handleWheel = this.handleWheel.bind(this);\n\t\tthis.handleMouseMove = this.handleMouseMove.bind(this);\n\t\tthis.handleMouseDown = this.handleMouseDown.bind(this);\n\t\tthis.handlePanEnd = this.handlePanEnd.bind(this);\n\t\tthis.handlePan = this.handlePan.bind(this);\n\t\tthis.handleTouchStart = this.handleTouchStart.bind(this);\n\t\tthis.handlePinchZoom = this.handlePinchZoom.bind(this);\n\t\tthis.handlePinchZoomEnd = this.handlePinchZoomEnd.bind(this);\n\n\t\tthis.handleClick = this.handleClick.bind(this);\n\n\t\tthis.handleRightClick = this.handleRightClick.bind(this);\n\t\tthis.handleDrag = this.handleDrag.bind(this);\n\t\tthis.handleDragEnd = this.handleDragEnd.bind(this);\n\n\t\tthis.shouldPan = this.shouldPan.bind(this);\n\t\tthis.canPan = this.canPan.bind(this);\n\n\t\tthis.setCursorClass = this.setCursorClass.bind(this);\n\t\tthis.saveNode = this.saveNode.bind(this);\n\n\t\tthis.mouseInside = false;\n\n\t\tthis.mouseInteraction = true;\n\t\tthis.state = {\n\t\t\tpanInProgress: false,\n\t\t};\n\t}\n\tsaveNode(node) {\n\t\tthis.node = node;\n\t}\n\tcomponentWillMount() {\n\t\tthis.focus = this.props.focus;\n\t}\n\tcomponentDidMount() {\n\t\tif (this.node) {\n\t\t\tselect(this.node)\n\t\t\t\t.on(MOUSEENTER, this.handleEnter)\n\t\t\t\t.on(MOUSELEAVE, this.handleLeave);\n\t\t}\n\t}\n\tcomponentDidUpdate() {\n\t\tthis.componentDidMount();\n\t}\n\tcomponentWillUnmount() {\n\t\tif (this.node) {\n\t\t\tselect(this.node)\n\t\t\t\t.on(MOUSEENTER, null)\n\t\t\t\t.on(MOUSELEAVE, null);\n\t\t\tconst win = d3Window(this.node);\n\t\t\tselect(win)\n\t\t\t\t.on(MOUSEMOVE, null);\n\t\t}\n\t}\n\thandleEnter() {\n\t\tconst e = d3Event;\n\n\t\tconst { onMouseEnter } = this.props;\n\t\tthis.mouseInside = true;\n\t\tif (!this.state.panInProgress\n\t\t\t\t&& !this.state.dragInProgress) {\n\t\t\tconst win = d3Window(this.node);\n\t\t\tselect(win)\n\t\t\t\t.on(MOUSEMOVE, this.handleMouseMove);\n\t\t}\n\t\tonMouseEnter(e);\n\t}\n\thandleLeave(e) {\n\t\tconst { onMouseLeave } = this.props;\n\t\tthis.mouseInside = false;\n\t\tif (!this.state.panInProgress\n\t\t\t\t&& !this.state.dragInProgress) {\n\t\t\tconst win = d3Window(this.node);\n\t\t\tselect(win)\n\t\t\t\t.on(MOUSEMOVE, null);\n\t\t}\n\t\tonMouseLeave(e);\n\t}\n\thandleWheel(e) {\n\t\tconst { zoom, onZoom } = this.props;\n\t\tconst { panInProgress } = this.state;\n\n\t\tconst yZoom = Math.abs(e.deltaY) > Math.abs(e.deltaX) && Math.abs(e.deltaY) > 0;\n\t\t// const xPan = Math.abs(e.deltaY) < Math.abs(e.deltaX) && Math.abs(e.deltaX) > 0;\n\t\tconst mouseXY = mousePosition(e);\n\t\te.preventDefault();\n\n\t\tif (zoom && this.focus && yZoom && !panInProgress) {\n\t\t\tconst zoomDir = e.deltaY > 0 ? 1 : -1;\n\n\t\t\tonZoom(zoomDir, mouseXY, e);\n\t\t} else if (this.focus) {\n\t\t\tif (this.shouldPan()) {\n\t\t\t\t// console.log(\"Do pan now...\")\n\t\t\t\t// pan already in progress\n\t\t\t\tconst {\n\t\t\t\t\tpanStartXScale,\n\t\t\t\t\tchartsToPan\n\t\t\t\t} = this.state.panStart;\n\t\t\t\tthis.lastNewPos = mouseXY;\n\t\t\t\tthis.panHappened = true;\n\n\t\t\t\tthis.dx += e.deltaX;\n\t\t\t\tthis.dy += e.deltaY;\n\t\t\t\tconst dxdy = { dx: this.dx, dy: this.dy };\n\n\t\t\t\tthis.props.onPan(mouseXY, panStartXScale, dxdy, chartsToPan, e);\n\t\t\t} else {\n\t\t\t\t// console.log(\"Pan start...\")\n\t\t\t\t// pan start\n\n\t\t\t\tconst { xScale, chartConfig } = this.props;\n\t\t\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\n\n\t\t\t\tthis.dx = 0;\n\t\t\t\tthis.dy = 0;\n\t\t\t\tthis.setState({\n\t\t\t\t\tpanInProgress: true,\n\t\t\t\t\tpanStart: {\n\t\t\t\t\t\tpanStartXScale: xScale,\n\t\t\t\t\t\tpanOrigin: mouseXY,\n\t\t\t\t\t\tchartsToPan: currentCharts\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.queuePanEnd();\n\t\t}\n\t}\n\tqueuePanEnd() {\n\t\tif (isDefined(this.panEndTimeout)) {\n\t\t\tclearTimeout(this.panEndTimeout);\n\t\t}\n\t\tthis.panEndTimeout = setTimeout(() => {\n\t\t\tthis.handlePanEnd();\n\t\t}, 100);\n\t}\n\thandleMouseMove() {\n\t\tconst e = d3Event;\n\n\t\tconst { onMouseMove, mouseMove } = this.props;\n\n\t\tif (this.mouseInteraction\n\t\t\t\t&& mouseMove\n\t\t\t\t&& !this.state.panInProgress) {\n\n\t\t\tconst newPos = mouse(this.node);\n\n\t\t\tonMouseMove(newPos, \"mouse\", e);\n\t\t}\n\t}\n\thandleClick(e) {\n\t\tconst mouseXY = mousePosition(e);\n\t\tconst { onClick, onDoubleClick } = this.props;\n\n\t\tif (!this.panHappened && !this.dragHappened) {\n\t\t\tif (this.clicked) {\n\t\t\t\tonDoubleClick(mouseXY, e);\n\t\t\t\tthis.clicked = false;\n\t\t\t} else {\n\t\t\t\tonClick(mouseXY, e);\n\t\t\t\tthis.clicked = true;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (this.clicked) {\n\t\t\t\t\t\tthis.clicked = false;\n\t\t\t\t\t}\n\t\t\t\t}, 400);\n\t\t\t}\n\t\t}\n\t}\n\thandleRightClick(e) {\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\t\tconst { onContextMenu, onPanEnd } = this.props;\n\n\t\tconst mouseXY = mousePosition(e, this.node.getBoundingClientRect());\n\n\t\tif (isDefined(this.state.panStart)) {\n\t\t\tconst { panStartXScale, panOrigin, chartsToPan } = this.state.panStart;\n\t\t\tif (this.panHappened) {\n\t\t\t\tonPanEnd(mouseXY, panStartXScale, panOrigin, chartsToPan, e);\n\t\t\t}\n\t\t\tconst win = d3Window(this.node);\n\t\t\tselect(win)\n\t\t\t\t.on(MOUSEMOVE, null)\n\t\t\t\t.on(MOUSEUP, null);\n\n\t\t\tthis.setState({\n\t\t\t\tpanInProgress: false,\n\t\t\t\tpanStart: null,\n\t\t\t});\n\t\t}\n\n\t\tonContextMenu(mouseXY, e);\n\t}\n\n\thandleDrag() {\n\t\tconst e = d3Event;\n\t\tif (this.props.onDrag) {\n\t\t\tthis.dragHappened = true;\n\t\t\tconst mouseXY = mouse(this.node);\n\t\t\tthis.props.onDrag({\n\t\t\t\tstartPos: this.state.dragStartPosition,\n\t\t\t\tmouseXY\n\t\t\t}, e);\n\t\t}\n\t}\n\tcancelDrag() {\n\t\tconst win = d3Window(this.node);\n\t\tselect(win)\n\t\t\t.on(MOUSEMOVE, this.mouseInside ? this.handleMouseMove : null)\n\t\t\t.on(MOUSEUP, null);\n\n\t\tthis.setState({\n\t\t\tdragInProgress: false,\n\t\t});\n\t\tthis.mouseInteraction = true;\n\t}\n\thandleDragEnd() {\n\t\tconst e = d3Event;\n\t\tconst mouseXY = mouse(this.node);\n\n\t\tconst win = d3Window(this.node);\n\t\tselect(win)\n\t\t\t.on(MOUSEMOVE, this.mouseInside ? this.handleMouseMove : null)\n\t\t\t.on(MOUSEUP, null);\n\n\t\tif (this.dragHappened) {\n\t\t\tthis.props.onDragComplete({\n\t\t\t\tmouseXY\n\t\t\t}, e);\n\t\t}\n\n\t\tthis.setState({\n\t\t\tdragInProgress: false,\n\t\t});\n\t\tthis.mouseInteraction = true;\n\t}\n\tcanPan() {\n\t\tconst { getAllPanConditions } = this.props;\n\t\tconst { pan: initialPanEnabled } = this.props;\n\n\t\tconst {\n\t\t\tpanEnabled,\n\t\t\tdraggable: somethingSelected\n\t\t} = getAllPanConditions()\n\t\t\t.reduce((returnObj, a) => {\n\t\t\t\treturn {\n\t\t\t\t\tdraggable: returnObj.draggable || a.draggable,\n\t\t\t\t\tpanEnabled: returnObj.panEnabled && a.panEnabled,\n\t\t\t\t};\n\t\t\t}, {\n\t\t\t\tdraggable: false,\n\t\t\t\tpanEnabled: initialPanEnabled,\n\t\t\t});\n\n\t\treturn {\n\t\t\tpanEnabled,\n\t\t\tsomethingSelected\n\t\t};\n\t}\n\thandleMouseDown(e) {\n\t\tif (e.button !== 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst { xScale, chartConfig, onMouseDown } = this.props;\n\n\t\tthis.panHappened = false;\n\t\tthis.dragHappened = false;\n\t\tthis.focus = true;\n\n\t\tif (!this.state.panInProgress\n\t\t\t&& this.mouseInteraction\n\t\t) {\n\n\t\t\tconst mouseXY = mousePosition(e);\n\t\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\n\t\t\tconst {\n\t\t\t\tpanEnabled, somethingSelected\n\t\t\t} = this.canPan();\n\t\t\tconst pan = panEnabled && !somethingSelected;\n\n\t\t\tif (pan) {\n\t\t\t\tthis.setState({\n\t\t\t\t\tpanInProgress: pan,\n\t\t\t\t\tpanStart: {\n\t\t\t\t\t\tpanStartXScale: xScale,\n\t\t\t\t\t\tpanOrigin: mouseXY,\n\t\t\t\t\t\tchartsToPan: currentCharts\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tconst win = d3Window(this.node);\n\t\t\t\tselect(win)\n\t\t\t\t\t.on(MOUSEMOVE, this.handlePan)\n\t\t\t\t\t.on(MOUSEUP, this.handlePanEnd);\n\n\t\t\t} else if (somethingSelected) {\n\t\t\t\tthis.setState({\n\t\t\t\t\tpanInProgress: false,\n\t\t\t\t\tdragInProgress: true,\n\t\t\t\t\tpanStart: null,\n\t\t\t\t\tdragStartPosition: mouseXY,\n\t\t\t\t});\n\t\t\t\tthis.props.onDragStart({ startPos: mouseXY }, e);\n\t\t\t\t// this.mouseInteraction = false;\n\n\t\t\t\tconst win = d3Window(this.node);\n\t\t\t\tselect(win)\n\t\t\t\t\t.on(MOUSEMOVE, this.handleDrag)\n\t\t\t\t\t.on(MOUSEUP, this.handleDragEnd);\n\t\t\t}\n\n\t\t\tonMouseDown(mouseXY, currentCharts, e);\n\t\t}\n\t\te.preventDefault();\n\t}\n\tshouldPan() {\n\t\tconst { pan: panEnabled, onPan } = this.props;\n\t\treturn panEnabled\n\t\t\t&& onPan\n\t\t\t&& isDefined(this.state.panStart);\n\t}\n\thandlePan() {\n\t\tconst e = d3Event;\n\n\t\tif (this.shouldPan()) {\n\t\t\tthis.panHappened = true;\n\n\t\t\tconst { panStartXScale, panOrigin, chartsToPan } = this.state.panStart;\n\n\t\t\tconst mouseXY = this.mouseInteraction\n\t\t\t\t? mouse(this.node)\n\t\t\t\t: touches(this.node)[0];\n\n\t\t\tthis.lastNewPos = mouseXY;\n\t\t\tconst dx = mouseXY[0] - panOrigin[0];\n\t\t\tconst dy = mouseXY[1] - panOrigin[1];\n\n\t\t\tthis.dx = dx;\n\t\t\tthis.dy = dy;\n\n\t\t\tthis.props.onPan(\n\t\t\t\tmouseXY, panStartXScale, { dx, dy }, chartsToPan, e\n\t\t\t);\n\t\t}\n\t}\n\thandlePanEnd() {\n\t\tconst e = d3Event;\n\t\tconst { pan: panEnabled, onPanEnd } = this.props;\n\n\t\tif (isDefined(this.state.panStart)) {\n\t\t\tconst { panStartXScale, chartsToPan } = this.state.panStart;\n\n\t\t\tconst win = d3Window(this.node);\n\t\t\tselect(win)\n\t\t\t\t.on(MOUSEMOVE, this.mouseInside ? this.handleMouseMove : null)\n\t\t\t\t.on(MOUSEUP, null)\n\t\t\t\t.on(TOUCHMOVE, null)\n\t\t\t\t.on(TOUCHEND, null);\n\n\t\t\tif (this.panHappened\n\t\t\t\t\t// && !this.contextMenuClicked\n\t\t\t\t\t&& panEnabled\n\t\t\t\t\t&& onPanEnd) {\n\t\t\t\tconst { dx, dy } = this;\n\n\t\t\t\t// console.log(dx, dy)\n\t\t\t\tdelete this.dx;\n\t\t\t\tdelete this.dy;\n\t\t\t\tonPanEnd(this.lastNewPos, panStartXScale, { dx, dy }, chartsToPan, e);\n\t\t\t}\n\n\t\t\tthis.setState({\n\t\t\t\tpanInProgress: false,\n\t\t\t\tpanStart: null,\n\t\t\t});\n\t\t}\n\t}\n\thandleTouchStart(e) {\n\t\tthis.mouseInteraction = false;\n\n\t\tconst { pan: panEnabled, chartConfig, onMouseMove } = this.props;\n\t\tconst { xScale, onPanEnd } = this.props;\n\n\t\tif (e.touches.length === 1) {\n\n\t\t\tthis.panHappened = false;\n\t\t\tconst touchXY = touchPosition(getTouchProps(e.touches[0]), e);\n\t\t\t// onMouseMove(touchXY, \"touch\", e);\n\t\t\tif (panEnabled) {\n\t\t\t\tconst currentCharts = getCurrentCharts(chartConfig, touchXY);\n\n\t\t\t\tthis.setState({\n\t\t\t\t\tpanInProgress: true,\n\t\t\t\t\tpanStart: {\n\t\t\t\t\t\tpanStartXScale: xScale,\n\t\t\t\t\t\tpanOrigin: touchXY,\n\t\t\t\t\t\tchartsToPan: currentCharts,\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tonMouseMove(touchXY, \"touch\", e);\n\n\t\t\t\tconst win = d3Window(this.node);\n\t\t\t\tselect(win)\n\t\t\t\t\t.on(TOUCHMOVE, this.handlePan, false)\n\t\t\t\t\t.on(TOUCHEND, this.handlePanEnd, false);\n\n\t\t\t}\n\t\t} else if (e.touches.length === 2) {\n\t\t\t// pinch zoom begin\n\t\t\t// do nothing pinch zoom is handled in handleTouchMove\n\t\t\tconst { panInProgress, panStart } = this.state;\n\n\t\t\tif (panInProgress && panEnabled && onPanEnd) {\n\t\t\t\tconst { panStartXScale, panOrigin, chartsToPan } = panStart;\n\n\t\t\t\tconst win = d3Window(this.node);\n\t\t\t\tselect(win)\n\t\t\t\t\t.on(MOUSEMOVE, this.mouseInside ? this.handleMouseMove : null)\n\t\t\t\t\t.on(MOUSEUP, null)\n\t\t\t\t\t.on(TOUCHMOVE, this.handlePinchZoom, false)\n\t\t\t\t\t.on(TOUCHEND, this.handlePinchZoomEnd, false);\n\n\t\t\t\tconst touch1Pos = touchPosition(getTouchProps(e.touches[0]), e);\n\t\t\t\tconst touch2Pos = touchPosition(getTouchProps(e.touches[1]), e);\n\n\t\t\t\tif (this.panHappened\n\t\t\t\t\t\t// && !this.contextMenuClicked\n\t\t\t\t\t\t&& panEnabled\n\t\t\t\t\t\t&& onPanEnd) {\n\n\t\t\t\t\tonPanEnd(this.lastNewPos, panStartXScale, panOrigin, chartsToPan, e);\n\t\t\t\t}\n\n\t\t\t\tthis.setState({\n\t\t\t\t\tpanInProgress: false,\n\t\t\t\t\tpinchZoomStart: {\n\t\t\t\t\t\txScale,\n\t\t\t\t\t\ttouch1Pos,\n\t\t\t\t\t\ttouch2Pos,\n\t\t\t\t\t\trange: xScale.range(),\n\t\t\t\t\t\tchartsToPan,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\thandlePinchZoom() {\n\t\tconst e = d3Event;\n\t\tconst [touch1Pos, touch2Pos] = touches(this.node);\n\t\tconst { xScale, zoom: zoomEnabled, onPinchZoom } = this.props;\n\n\t\t// eslint-disable-next-line no-unused-vars\n\t\tconst { chartsToPan, ...initialPinch } = this.state.pinchZoomStart;\n\n\t\tif (zoomEnabled && onPinchZoom) {\n\t\t\tonPinchZoom(initialPinch, {\n\t\t\t\ttouch1Pos,\n\t\t\t\ttouch2Pos,\n\t\t\t\txScale,\n\t\t\t}, e);\n\t\t}\n\t}\n\thandlePinchZoomEnd() {\n\t\tconst e = d3Event;\n\n\t\tconst win = d3Window(this.node);\n\t\tselect(win)\n\t\t\t.on(TOUCHMOVE, null)\n\t\t\t.on(TOUCHEND, null);\n\n\t\tconst { zoom: zoomEnabled, onPinchZoomEnd } = this.props;\n\n\t\t// eslint-disable-next-line no-unused-vars\n\t\tconst { chartsToPan, ...initialPinch } = this.state.pinchZoomStart;\n\n\t\tif (zoomEnabled && onPinchZoomEnd) {\n\t\t\tonPinchZoomEnd(initialPinch, e);\n\t\t}\n\n\t\tthis.setState({\n\t\t\tpinchZoomStart: null\n\t\t});\n\t}\n\tsetCursorClass(cursorOverrideClass) {\n\t\tif (cursorOverrideClass !== this.state.cursorOverrideClass) {\n\t\t\tthis.setState({\n\t\t\t\tcursorOverrideClass\n\t\t\t});\n\t\t}\n\t}\n\trender() {\n\t\tconst { height, width } = this.props;\n\t\tconst className = this.state.cursorOverrideClass != null\n\t\t\t? this.state.cursorOverrideClass\n\t\t\t: this.state.panInProgress\n\t\t\t\t? \"react-stockcharts-grabbing-cursor\"\n\t\t\t\t: \"react-stockcharts-crosshair-cursor\";\n\n\t\treturn (\n\t\t\t<rect ref={this.saveNode}\n\t\t\t\tclassName={className}\n\t\t\t\twidth={width}\n\t\t\t\theight={height}\n\t\t\t\tstyle={{ opacity: 0 }}\n\t\t\t\tonWheel={this.handleWheel}\n\t\t\t\tonMouseDown={this.handleMouseDown}\n\t\t\t\tonClick={this.handleClick}\n\t\t\t\tonContextMenu={this.handleRightClick}\n\t\t\t\tonTouchStart={this.handleTouchStart}\n\t\t\t/>\n\t\t);\n\t}\n}\n\n// \t\t\t\tonMouseEnter={this.handleEnter}\n//\t\t\t\tonMouseLeave={this.handleLeave}\n\n\nEventCapture.propTypes = {\n\tmouseMove: PropTypes.bool.isRequired,\n\tzoom: PropTypes.bool.isRequired,\n\tpan: PropTypes.bool.isRequired,\n\tpanSpeedMultiplier: PropTypes.number.isRequired,\n\tfocus: PropTypes.bool.isRequired,\n\n\twidth: PropTypes.number.isRequired,\n\theight: PropTypes.number.isRequired,\n\tchartConfig: PropTypes.array,\n\txScale: PropTypes.func.isRequired,\n\txAccessor: PropTypes.func.isRequired,\n\n\tgetAllPanConditions: PropTypes.func.isRequired,\n\n\tonMouseMove: PropTypes.func,\n\tonMouseEnter: PropTypes.func,\n\tonMouseLeave: PropTypes.func,\n\tonZoom: PropTypes.func,\n\tonPinchZoom: PropTypes.func,\n\tonPinchZoomEnd: PropTypes.func.isRequired,\n\tonPan: PropTypes.func,\n\tonPanEnd: PropTypes.func,\n\tonDragStart: PropTypes.func,\n\tonDrag: PropTypes.func,\n\tonDragComplete: PropTypes.func,\n\n\tonClick: PropTypes.func,\n\tonDoubleClick: PropTypes.func,\n\tonContextMenu: PropTypes.func,\n\tonMouseDown: PropTypes.func,\n\tchildren: PropTypes.node,\n};\n\nEventCapture.defaultProps = {\n\tmouseMove: false,\n\tzoom: false,\n\tpan: false,\n\tpanSpeedMultiplier: 1,\n\tfocus: false,\n\tonDragComplete: noop,\n};\n\nexport default EventCapture;\n"]}